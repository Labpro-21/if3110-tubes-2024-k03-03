<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Login</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - LinkInPurry</title>
    <link rel="stylesheet" href="../css/register.css">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.6.0/css/all.css">
</head>

<body>
    <div class="background1"></div>
    <div class="selection" id="selection">
        <div class="centerbox">
            <h1>Welcome! Are you a</h1>
            <div class="choice-button-container">
                <button href="#" id="buttonA" class="big-round-button">
                    JobSeeker</button>
                <button href="#" id="buttonB" class="big-round-button"
                    >Company</button>
            </div>
        </div>
    </div>
    <div class="information" id="information">
        <div class="reportbox information-top success" hidden style="position: absolute; top: 5%;">This is a reportbox</div>
        <div class="centerbox">
            <h1 id="splashtext">One step away!</h1>
            <form id="userinfo">
                <label>Full name</label>
                <input class="input-box" type="text" id="fullname">
                <label>E-mail</label>
                <input class="input-box" type="text" id="email">
                <label>Password</label>
                <span>
                    <input class="input-box" type="password" id="password">
                    <span class="show_password">Show password<input id="password_visible" type="checkbox"></span>
                </span>
                <label>Confirm password</label>
                <span>
                    <input class="input-box" type="password" id="confirmpassword">
                    <span class="show_password">Show password<input id="checkpassword_visible" type="checkbox"></span>
                </span>
                <span>
                    <label class="reportbox fail" id="password_report" hidden>
                        Password is incorrect!</label>
                </span>
                <button type="button" class="submit_data" id="submit_data" disabled> Submit! </button>
            </form>

            <h1>Back</h1>
        </div>
    </div>


    <script async defer>
        window.onbeforeunload = function () {
            window.scrollTo(0, 0);
        }

        var buttonA = document.getElementById("buttonA");
        var buttonB = document.getElementById("buttonB");
        var splashtext = document.getElementById("splashtext");
        var selection = document.getElementById("selection");
        var information = document.getElementById("information");
        var selectedType = "None";
        var goodPassword = false;


        function funcA() {
            console.log("TestA");
            splashtext.textContent = "One step away from opportunities!";
            information.scrollIntoView({ behavior: "smooth" });
            selectedType = "jobseeker"
        }

        function funcB() {
            console.log("TestB");
            splashtext.textContent = "One step away from meeting potential!";
            information.scrollIntoView({ behavior: "smooth" });
            selectedType = "company"
        }

        buttonA.addEventListener("click", funcA);
        buttonB.addEventListener("click", funcB);


        //INPUT RELATED
        var namebox = document.getElementById("fullname");
        var emailbox = document.getElementById("email")
        var firstPassword = document.getElementById("password");
        var checkPassword = document.getElementById("confirmpassword");
        var passwordReport = document.getElementById("password_report");

        function checkpasswordCorrect() {
            var password1 = firstPassword.value;
            var password2 = checkPassword.value;
            console.log("change");
            if (password1 == password2) {
                passwordReport.hidden = true;
                goodPassword = true
            }
            else {
                passwordReport.hidden = false;
                goodPassword = false
            }
        }

        firstPassword.addEventListener("input", checkpasswordCorrect);
        checkPassword.addEventListener("input", checkpasswordCorrect);

        function checkEmail(email) {
            const emailRegexCheck = /^[\w-\.]+@([\w-]+\.)+[\w-]+$/;
            return emailRegexCheck.test(email);
        }

        document.getElementById("password_visible").addEventListener("change", function () {
            if (this.checked) {
                firstPassword.type = 'text';
            }
            else {
                firstPassword.type = 'password';
            }
        })

        document.getElementById("checkpassword_visible").addEventListener("change", function () {
            if (this.checked) {
                checkPassword.type = 'text';
            }
            else {
                checkPassword.type = 'password';
            }
        })

        //upload check

        var uploadButton = document.getElementById("submit_data");

        function canUpload() {
            if (namebox.value != "" && emailbox != "" && firstPassword != "" && checkPassword != "" && goodPassword) {
                uploadButton.disabled = false;
                return true;
            }
            else {
                uploadButton.disabled = true;
                return false;
            }
        }
        namebox.addEventListener("input", canUpload);
        emailbox.addEventListener("input", canUpload);
        firstPassword.addEventListener("input", canUpload);
        checkPassword.addEventListener("input", canUpload);

        uploadButton.addEventListener("click", submit)

        function submit() {
            if (canUpload()) {
                var xmlh = new XMLHttpRequest();
                xmlh.open('POST', '../auth/register.php');
                xmlh.onreadystatechange = function () {
                    if (xmlh.readyState == 4 && xmlh.status == 200) {
                        //Report success
                        console.log("testlmao");
                        try {
                            const ajaxrespone = JSON.parse(xmlh.response);
                            console.log(ajaxrespone);

                            if (ajaxrespone["Success"] == true) {
                                setTimeout(function () {
                                    window.location.href = "../login.html";
                                }, 3000);
                            }
                            else {
                                console.warn("Failure");
                            }
                        } catch (error) {
                            console.warn(xmlh.response);
                        }
                        //xmlh.response


                        //IF SUCCESS GO TO LOGIN
                    }
                    else {
                        //console.log("fail?");
                    }
                };

                const nama = namebox.value;
                const email = emailbox.value;
                const pass = password.value;

                xmlh.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                xmlh.send("role=" + selectedType + "&nama=" + nama + "&email=" + email + "&password=" + pass);
            }
            else {
                console.error("Nice try!");
            }
        }

        function report(success, reason) {
            if (success == true) {

            }
            else {

            }
        }

        function hide_report() {

        }

    </script>
</body>

</html>